<UserControl x:Class="TamponiInventario.Wpf.Views.AdminView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">
  <TabControl>
    <TabItem Header="Gestione tamponi">
      <Grid Margin="0,12,0,0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>

        <Border Style="{StaticResource CardBorderStyle}" Margin="0,0,8,0">
          <StackPanel>
            <TextBlock Text="Nuovo tampone" FontSize="20" FontWeight="Bold" />
            <TextBlock Text="SKU" Style="{StaticResource MutedTextStyle}" Margin="0,12,0,0" />
            <TextBox Text="{Binding NewSwabSku, UpdateSourceTrigger=PropertyChanged}" />
            <TextBlock Text="Nome tampone" Style="{StaticResource MutedTextStyle}" Margin="0,12,0,0" />
            <TextBox Text="{Binding NewSwabName, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="Aggiungi tampone" Margin="0,16,0,0" Padding="12,6" Command="{Binding AddSwabCommand}" />
          </StackPanel>
        </Border>

        <Border Grid.Column="1" Style="{StaticResource CardBorderStyle}" Margin="8,0,0,0">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <RowDefinition Height="*" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TextBlock Text="Lista tamponi (Admin)" FontSize="20" FontWeight="Bold" />

            <StackPanel Grid.Row="1" Margin="0,12,0,0">
              <TextBlock Text="Cerca" Style="{StaticResource MutedTextStyle}" />
              <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                <TextBox Width="240" Text="{Binding SwabSearchQuery, UpdateSourceTrigger=PropertyChanged}" />
                <Button Content="Filtra" Margin="8,0,0,0" Padding="12,4" Command="{Binding ApplyFilterCommand}" />
              </StackPanel>
            </StackPanel>

            <DataGrid Grid.Row="2" Margin="0,16,0,0" ItemsSource="{Binding FilteredSwabs}" SelectedItem="{Binding SelectedSwab}"
                      AutoGenerateColumns="False" HeadersVisibility="Column" CanUserAddRows="False" CanUserDeleteRows="False">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Tampone" Binding="{Binding Name}" Width="2*" />
                <DataGridTextColumn Header="SKU" Binding="{Binding Sku}" Width="*" />
                <DataGridTextColumn Header="Stato" Binding="{Binding Status}" Width="*" />
                <DataGridTextColumn Header="Macchina" Binding="{Binding MachineName}" Width="*" />
                <DataGridTextColumn Header="Ultimo PRESO" Binding="{Binding LastTake}" Width="*" />
                <DataGridTextColumn Header="Ultimo RESO" Binding="{Binding LastReturn}" Width="*" />
                <DataGridTemplateColumn Header="Azioni" Width="*">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Modifica" Padding="8,2" Margin="0,0,6,0"
                                Command="{Binding DataContext.EditSwabCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                CommandParameter="{Binding}" />
                        <Button Content="Elimina" Padding="8,2"
                                Command="{Binding DataContext.DeleteSwabCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                CommandParameter="{Binding}" />
                      </StackPanel>
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
              </DataGrid.Columns>
            </DataGrid>

            <TextBlock Grid.Row="3" Margin="0,12,0,0" Style="{StaticResource MutedTextStyle}">
              Nota: non puoi eliminare un tampone se risulta PRESO (rendilo prima).
            </TextBlock>
          </Grid>
        </Border>
      </Grid>
    </TabItem>

    <TabItem Header="Gestione macchine">
      <Grid Margin="0,12,0,0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>

        <Border Style="{StaticResource CardBorderStyle}" Margin="0,0,8,0">
          <StackPanel>
            <TextBlock Text="Nuova macchina" FontSize="20" FontWeight="Bold" />
            <TextBlock Text="Nome macchina" Style="{StaticResource MutedTextStyle}" Margin="0,12,0,0" />
            <TextBox Text="{Binding NewMachineName, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="Aggiungi macchina" Margin="0,16,0,0" Padding="12,6" Command="{Binding AddMachineCommand}" />
          </StackPanel>
        </Border>

        <Border Grid.Column="1" Style="{StaticResource CardBorderStyle}" Margin="8,0,0,0">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="*" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TextBlock Text="Lista macchine" FontSize="20" FontWeight="Bold" />

            <DataGrid Grid.Row="1" Margin="0,16,0,0" ItemsSource="{Binding Machines}" SelectedItem="{Binding SelectedMachine}"
                      AutoGenerateColumns="False" HeadersVisibility="Column" CanUserAddRows="False" CanUserDeleteRows="False">
              <DataGrid.Columns>
                <DataGridTextColumn Header="Macchina" Binding="{Binding Name}" Width="*" />
                <DataGridTemplateColumn Header="Azioni" Width="*">
                  <DataGridTemplateColumn.CellTemplate>
                    <DataTemplate>
                      <Button Content="Elimina" Padding="8,2"
                              Command="{Binding DataContext.DeleteMachineCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                              CommandParameter="{Binding}" />
                    </DataTemplate>
                  </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
              </DataGrid.Columns>
            </DataGrid>

            <TextBlock Grid.Row="2" Margin="0,12,0,0" Style="{StaticResource MutedTextStyle}">
              Nota: non puoi eliminare una macchina se Ã¨ associata a un tampone attualmente PRESO.
            </TextBlock>
          </Grid>
        </Border>
      </Grid>
    </TabItem>

    <TabItem Header="Impostazioni">
      <Border Style="{StaticResource CardBorderStyle}" Margin="0,12,0,0">
        <StackPanel>
          <TextBlock Text="Impostazioni" FontSize="20" FontWeight="Bold" />
          <TextBlock Text="Aggiorna le soglie globali per i tamponi in uso: avviso per giorni in scadenza e allarme per giorni superati." Style="{StaticResource MutedTextStyle}" Margin="0,6,0,0" TextWrapping="Wrap" />

          <TextBlock Text="Soglia globale avviso (giorni in scadenza)" Style="{StaticResource MutedTextStyle}" Margin="0,12,0,0" />
          <TextBox Text="{Binding GlobalWarnDays}" />

          <TextBlock Text="Soglia globale allarme (giorni superati)" Style="{StaticResource MutedTextStyle}" Margin="0,12,0,0" />
          <TextBox Text="{Binding GlobalAlarmDays}" />

          <Button Content="Salva impostazioni" Margin="0,16,0,0" Padding="12,6" Command="{Binding SaveSettingsCommand}" />
        </StackPanel>
      </Border>
    </TabItem>
  </TabControl>
</UserControl>
