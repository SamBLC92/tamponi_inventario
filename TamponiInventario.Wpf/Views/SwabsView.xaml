<UserControl x:Class="TamponiInventario.Wpf.Views.SwabsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">
  <Border Style="{StaticResource CardBorderStyle}">
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <TextBlock Text="Lista tamponi" FontSize="20" FontWeight="Bold" />

      <StackPanel Grid.Row="1" Margin="0,12,0,0">
        <TextBlock Text="Cerca" Style="{StaticResource MutedTextStyle}" FontSize="12" />
        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
          <TextBox Width="280" Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" />
          <Button Content="Filtra" Margin="8,0,0,0" Padding="12,4" Command="{Binding ApplyFilterCommand}" />
          <Button Content="Aggiungi tampone" Margin="8,0,0,0" Padding="12,4" Command="{Binding AddSwabCommand}" />
          <Button Content="Modifica" Margin="8,0,0,0" Padding="12,4" Command="{Binding EditSwabCommand}" />
          <Button Content="Elimina" Margin="8,0,0,0" Padding="12,4" Command="{Binding DeleteSwabCommand}" />
        </StackPanel>
      </StackPanel>

      <DataGrid Grid.Row="2" Margin="0,16,0,0" ItemsSource="{Binding FilteredSwabs}" SelectedItem="{Binding SelectedSwab}"
                AutoGenerateColumns="False" HeadersVisibility="Column" CanUserAddRows="False" CanUserDeleteRows="False">
        <DataGrid.Columns>
          <DataGridTextColumn Header="Tampone" Binding="{Binding Name}" Width="2*" />
          <DataGridTextColumn Header="SKU" Binding="{Binding Sku}" Width="*" />
          <DataGridTemplateColumn Header="Stato" Width="2*">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal">
                  <Border Style="{StaticResource PillOkStyle}">
                    <TextBlock Text="{Binding Status}" Style="{StaticResource PillText}" />
                  </Border>
                  <Border Style="{StaticResource PillWarnStyle}" Visibility="{Binding Warning, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="Avviso" Style="{StaticResource PillText}" />
                  </Border>
                  <Border Style="{StaticResource PillErrorStyle}" Visibility="{Binding Alarm, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="Allarme" Style="{StaticResource PillText}" />
                  </Border>
                </StackPanel>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>
          <DataGridTextColumn Header="Macchina" Binding="{Binding MachineName}" Width="*" />
          <DataGridTextColumn Header="Ultimo PRESO" Binding="{Binding LastTake}" Width="*" />
          <DataGridTextColumn Header="Ultimo RESO" Binding="{Binding LastReturn}" Width="*" />
          <DataGridTemplateColumn Header="Giorni uso" Width="*">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal">
                  <Border Style="{StaticResource PillOkStyle}">
                    <TextBlock Text="{Binding TotalDays, StringFormat=Tot: {0}}" Style="{StaticResource PillText}" />
                  </Border>
                  <Border Style="{StaticResource PillWarnStyle}" Visibility="{Binding CurrentDays, Converter={StaticResource IntToVisibilityConverter}}">
                    <TextBlock Text="{Binding CurrentDays, StringFormat=Ora: {0}}" Style="{StaticResource PillText}" />
                  </Border>
                </StackPanel>
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>
        </DataGrid.Columns>
      </DataGrid>

      <TextBlock Grid.Row="3" Margin="0,12,0,0" Style="{StaticResource MutedTextStyle}">
        Nota: non puoi eliminare un tampone se risulta PRESO (rendilo prima).
      </TextBlock>
    </Grid>
  </Border>
</UserControl>
