{% extends "base.html" %}
{% block content %}
  <div class="card">
    <h1>Storico movimenti (ultimi {{ limit }})</h1>
    <p class="muted">Movimenti registrati: <strong>PRESO</strong> e <strong>RESO</strong>.</p>

    <div class="table-wrap">
      <table class="rtable">
        <thead>
          <tr>
            <th>Data</th>
            <th>Azione</th>
            <th>Tampone</th>
            <th>SKU</th>
            <th>Macchina</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td data-label="Data" class="mono">{{ r["ts"] | it_datetime }}</td>

              <td data-label="Azione">
                {% if r["action"] == "TAKE" %}
                  <span class="pill warn">PRESO</span>
                {% else %}
                  <span class="pill ok">RESO</span>
                {% endif %}
              </td>

              <td data-label="Tampone"><strong>{{ r["name"] }}</strong></td>
              <td data-label="SKU" class="mono muted">{{ r["sku"] }}</td>

              <td data-label="Macchina">
                {% if r["action"] == "TAKE" and r["machine_name"] %}
                  <span class="pill warn">{{ r["machine_name"] }}</span>
                {% else %}
                  <span class="muted small">Magazzino</span>
                {% endif %}
              </td>

              <td data-label="Note" class="muted">{{ r["note"] }}</td>
            </tr>
          {% endfor %}

          {% if rows|length == 0 %}
            <tr><td colspan="6" class="muted">Nessun movimento.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
